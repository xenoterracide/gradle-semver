A semantic versioning plugin that derives the version from git tags and commits and is configuration cache safe.

[source,gradle.kts]
----
plugins {
  id("com.xenoterracide.gradle.semver")
}
----

https://github.com/gradle/gradle/issues/29342[Gradle isn't lazy with anything related to publishing].
Even when it becomes lazy I doubt it'll be as lazy as you want.
So I do the following, and then only set `IS_PUBLISHING` in my publishing build in CI.
This avoids constant configuration cache busting as well as ensuring that IO is kept to a minimum.

[source,gradle.kts]
----
import org.semver4j.Semver

version = providers.environmentVariable("IS_PUBLISHING")
  .map { semver.provider().get() }
  .orElse(Semver("0.0.0")).get()
----

[source,kts]
----

----

This plugin expects that you will `git tag` in the format of `v0.1.1` and with only one number on prerelease versions, e.g. `v0.1.1-rc.1`.
It also expects that you will use annotated tags.

[source,kts]
----
// given the last tag was v0.1.0 and you have a commit distance == 1 you'll get something like
logger.quiet("semver " + semver.provider().get()        // 0.1.1-alpha.0.1+g3aae11e

// other available outputs
logger.quiet("branch:" + gitMetadata.branch )
logger.quiet("commit:" + gitMetadata.commit)
logger.quiet("commitShort:" + gitMetadata.commitShort)
logger.quiet("latestTag:" + gitMetadata.latestTag)
logger.quiet("describe:" + gitMetadata.describe)
logger.quiet("commitDistance:" + gitMetadata.commitDistance)
logger.quiet("status:" + gitMetadata.status)
----

if you want you can expose whether your tree is dirty or not.

[source,kts]
----
semver {
  checkDirty.set(true)
}

logger.quiet("semver " + semver.provider().get()        // 0.1.1-alpha.0.1+g3aae11e.dirty
----

The plugin exposes https://javadoc.io/doc/org.semver4j/semver4j/latest/index.html[Semver4j].
